<div class="content">
  <div class="canvas">

    <!--
        <app-game-canvas></app-game-canvas>
    -->
    <!--
   Put The Mission round and if success or fail here for now
-->

    <h4 *ngFor="let mission of gameDetails.missionRounds | keyvalue">
      {{mission.key}} --> {{mission.value ? 'Resistance' : 'Spies'}}
    </h4>

  </div>
  <div class="game-values">
    <div>
      <!--todo don't show these if game is over-->
      <div>
        <h6>Mission: <b>{{gameDetails.currentMissionRound}}.</b>
          <span *ngFor="let i of [].constructor(gameDetails.voteFailedCount)" style="padding-left: 5px">
         <fa-icon [icon]="xMarkIcon" class=" fa-sm redIcon"></fa-icon>
        </span>
          <span *ngFor="let i of [].constructor(5 - gameDetails.voteFailedCount)" style="padding-left: 5px">
         <fa-icon [icon]="xMarkIcon" class=" fa-sm greyIcon"></fa-icon>
        </span>
        </h6>

        <h6>Mission Size: <b>{{gameDetails.missionSize}}</b></h6>
        <h6>Mission Leader: <b class="userName">{{getMissionLeaderUsername()}}</b></h6>

        <h6>Team Members:
          <span *ngFor="let playerDetail of gameDetails.missionTeam" class="userName">&nbsp;{{playerDetail.userName}}.&nbsp;</span>
        </h6>
      </div>
    </div>

    <!--GameStage.MissionPropose-->
    <div *ngIf="gameDetails.gameStage === 1">
      <h4>Mission Propose </h4>
      <div *ngIf="missionLeaderPlayerId === playerId">
        <button (click)="submitTeam()"
                [disabled]="gameDetails.missionTeam.length !== gameDetails.missionSize"
                [ngClass]="gameDetails.missionTeam.length !== gameDetails.missionSize ? 'button-disabled':'propose-team-button'">
          Submit Team
        </button>
      </div>
    </div>

    <!--GameStage.Vote-->
    <div *ngIf="gameDetails.gameStage === 2">
      <h4>Voting</h4>
      <div *ngIf="!voted">

        <button (click)="submitVote(false)" class="vote-button reject-button">
          Reject
        </button>
        &nbsp;
        <button (click)="submitVote(true)" class="vote-button approve-button">
          Approve
        </button>

      </div>
      <div *ngIf="voted">
        <span>Waiting For:</span>
        <span *ngFor="let playerDetail of gameDetails.playersDetails">

              <span *ngIf="!playerDetail.voted && !playerDetail.isBot" class="userName"> &nbsp;{{playerDetail.userName}}.&nbsp; </span>
            </span>
      </div>
    </div>


    <!--GameStage.VoteResults-->
    <div *ngIf="gameDetails.gameStage === 3">
      <h4>Voting Results</h4>

      <div>
          <span *ngFor="let playerDetail of gameDetails.playersDetails">
            <b class="userName">{{playerDetail.userName}}</b>
            &nbsp;
            <fa-icon *ngIf="!playerDetail.approvedMissionTeam" [icon]="crossIcon" class="icon redIcon"></fa-icon>
              <fa-icon *ngIf="playerDetail.approvedMissionTeam" [icon]="tickIcon" class="icon greenIcon"></fa-icon>
            &nbsp;
          </span>
      </div>

      <span (click)="submitContinue()" *ngIf="!continued" class="icon-click continue">Continue
        <fa-icon [icon]="nextIcon" class="fa-md"></fa-icon>
     </span>
      <span *ngIf="continued">Waiting For:
        <span *ngFor="let playerDetail of gameDetails.playersDetails">
              <span *ngIf="!playerDetail.continued && !playerDetail.isBot" class="userName"> &nbsp;{{playerDetail.userName}}.&nbsp; </span>
        </span>
      </span>
    </div>


    <!--GameStage.Mission-->
    <div *ngIf="gameDetails.gameStage === 4">
      <h4>Mission</h4>
      <div *ngIf="playerIsOnMissionTeam(playerId)">
        <div *ngIf="!chose">
          <button (click)="submitMissionChoice(false)" class="vote-button" [disabled]="getPlayerDetails().team === 0"
                  [ngClass]="getPlayerDetails().team === 0 ? 'button-disabled':'reject-button'"
          >
            Sabotage
          </button>
          &nbsp;
          <button (click)="submitMissionChoice(true)" class="vote-button approve-button"
          >
            Support
          </button>
        </div>
      </div>
      <div *ngIf="chose || !playerIsOnMissionTeam(playerId)">
        <span>Waiting For:</span>
        <span *ngFor="let playerDetail of gameDetails.playersDetails">

              <span *ngIf=" playerIsOnMissionTeam(playerDetail.playerId) && !playerDetail.chose && !playerDetail.isBot" class="userName">&nbsp;{{playerDetail.userName}}
                .&nbsp;</span>
            </span>
      </div>
    </div>


    <!--GameStage.MissionResults-->
    <div *ngIf="gameDetails.gameStage === 5">
      <h4>Mission Results</h4>
      <div>
      <span *ngFor="let missionOutcome of gameDetails.missionOutcome">
            <fa-icon *ngIf="!missionOutcome" [icon]="crossIcon" class="icon redIcon"></fa-icon>
            <fa-icon *ngIf="missionOutcome" [icon]="tickIcon" class="icon greenIcon"></fa-icon>
            &nbsp;
          </span>
      </div>
      <span (click)="submitContinue()" *ngIf="!continued" class="icon-click continue">Continue
        <fa-icon [icon]="nextIcon" class="fa-md"></fa-icon>
     </span>
      <span *ngIf="continued">Waiting For:
        <span *ngFor="let playerDetail of gameDetails.playersDetails">
              <span *ngIf="!playerDetail.continued && !playerDetail.isBot" class="userName"> &nbsp;{{playerDetail.userName}}.&nbsp; </span>
        </span>
      </span>
    </div>

    <!--GameStage.GameOverSpiesWon || GameStage.GameOverResistanceWon-->
    <div *ngIf="gameDetails.gameStage === 6 || gameDetails.gameStage === 7">
      <h4>Game Over</h4>
      <h4 *ngIf="gameDetails.gameStage === 6">Spies Won</h4>
      <h4 *ngIf="gameDetails.gameStage === 7">Resistance Won</h4>

      <span *ngFor="let playerDetail of gameDetails.playersDetails">
              <span *ngIf="playerDetail.team === 1 " class="userName redIcon"> &nbsp;{{playerDetail.userName}}.&nbsp; </span>
              <span *ngIf="playerDetail.team === 0 " class="userName blueIcon"> &nbsp;{{playerDetail.userName}}.&nbsp; </span>

        </span>
      <div>
        <countdown #gameOverCountdown (event)="handleGameOverCountdownEvent($event)" [config]="gameOverCountdownConfig"
                   class="countdowns"></countdown>
      </div>
    </div>
  </div>


  <!--Lobby Grid-->
  <div class="grid-container lobby-box">
    <div *ngFor="let playerDetail of gameDetails.playersDetails"
         [ngClass]="{
                      'red-border-box': gameDetails.gameStage === 3 && !playerDetail.approvedMissionTeam,
                      'green-border-box':gameDetails.gameStage === 3 && playerDetail.approvedMissionTeam,
                      'white-border-box':playerIsOnMissionTeam(playerDetail.playerId)
          }"
         class="grid-item">
      <fa-icon *ngIf="playerDetail.playerId === missionLeaderPlayerId" [icon]="missionLeaderIcon" class="icon"></fa-icon>
      <div class="top-row-icons">
        <!--For If User is Mission Team Leader && GameStage Is Mission Propose
            They Will have Selectable Mission Team Member Icons-->
        <div *ngIf="missionLeaderPlayerId === playerId && gameDetails.gameStage === 1">
          <fa-icon (click)="teamMemberClicked(playerDetail.playerId)" [icon]="addMemberIcon" class="fa-lg icon-click"></fa-icon>
        </div>

        <fa-icon *ngIf="playerIsOnMissionTeam(playerDetail.playerId)" [icon]="missionTeamMemberIcon"></fa-icon>

      </div>
      <div>
        <h6 [ngClass]="{
                      'highlight-spy':highlightMap.has(playerDetail.playerId) && highlightMap.get(playerDetail.playerId),
                      'highlight-resistance':highlightMap.has(playerDetail.playerId) && !highlightMap.get(playerDetail.playerId)
          }"> {{playerDetail.userName}}
          <div class="btn-group" placement="right" ngbDropdown>
            <button type="button" class="btn btn-dark btn-sm dropdownButton" ngbDropdownToggle>
            </button>
            <div class="dropdown-menu" ngbDropdownMenu>
              <button class="resistance-option" ngbDropdownItem (click)="highlight(playerDetail.playerId,false)">
                <fa-icon [icon]="userCheckIcon" class="fa-sm"></fa-icon>
              </button>
              <button class="spy-option" ngbDropdownItem (click)="highlight(playerDetail.playerId,true)">
                <fa-icon [icon]="userSecretIcon" class="fa-sm"></fa-icon>
              </button>
              <button class="eraser-option" ngbDropdownItem (click)="removeHighlight(playerDetail.playerId)">
                <fa-icon [icon]="eraserIcon" class="fa-sm"></fa-icon>
              </button>

            </div>
          </div>
        </h6>
        <i class="fa-solid fa-person-military-rifle"></i>

      </div>

      <div *ngIf="playerDetail.discordUserName">
        <h6 class="discord-name">
          <fa-icon [icon]="discordIcon" class="fa-sm"></fa-icon>
          : {{playerDetail.discordUserName}}</h6>
      </div>
    </div>
  </div>

  <div class="countdown-values">

    <div>The Resistance</div>
    <div style="float: left">
      <span>Game Time Limit: </span>
      <countdown #gameCountdown [config]="gameCountdownConfig" class="countdowns"></countdown>
    </div>
  </div>

  <!---->
</div>

